FROM ubuntu:latest

# install php, sodium, composer
RUN apt-get update && apt-get install -y \
    php-cli \
    php-dom \
    php-xml \
    php-curl \
    php-dev \
    curl \
    unzip

RUN pecl install ast
RUN echo "extension=ast.so" > /etc/php/$(php -r "echo PHP_MAJOR_VERSION.'.'.PHP_MINOR_VERSION;")/cli/conf.d/20_ast.ini

# install composer
RUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer

# set working directory
WORKDIR /app

# Copy root folder to container
COPY . /app

# Install any needed packages specified in composer.json
RUN rm composer.lock
RUN rm -rf vendor/
RUN php -v
RUN composer install

# Run composer phan
CMD ["composer", "phan"]

